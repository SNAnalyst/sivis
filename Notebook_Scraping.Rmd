---
title: "R Notebook"
output: html_notebook
---

This is a scraping suggestion for the following website: 
function(nr) 'https://www.r-bloggers.com/'

```{r}
options(stringsAsFactors = FALSE)
library(xml2)
library(httr)
library(DT)
urlGen <- function(nr) 'https://www.r-bloggers.com/'
nr <- 1
hasResult <- TRUE
output <- list()

while(hasResult){
	print(nr)
	url <- urlGen(nr)
	response <- url %>% httr::GET() %>% httr::content(type = "text", encoding = "UTF-8")
	xpath <- data.frame(
		"/html/body/div/div/div/div/article/header/h3/a[not(descendant::*)]"
	)
	response <- tryCatch(
		expr = response %>% xml2::read_html() %>% rvest::html_nodes(xpath = as.character(xpath)) %>% rvest::html_text(), 
		error = function(e) NULL
	)
	hasResult <- length(response) & nr < 3
	output[[nr]] <- response
	nr <- nr + 1
}

output %>% 
	lapply(FUN = data.frame) %>% 
	do.call(what = rbind) %>% 
	DT::datatable()
```

```{r}
post_To_Production(host = "http://192.168.1.11")
```



Potential new fields to consider:

```{r}
#load('multicol_filt_19.RData')

library(shiny)

ui <- fluidPage(
	h3(shiny::tags$b("Suggestions for additional data to scrape.")),
	h5(shiny::tags$b("Click on columns to add/remove an xpath from the scraper.")),
	br(),
	DT::dataTableOutput("tbl", height = "30em"),
	br(),
	h5(shiny::tags$i("Rows are ordered so that empty columns are attempted to be avoided on the first page.")),
	br(),
	actionButton(
		inputId = "update_document",
		label = "Add selected columns to document:",
		icon("paper-plane"),
		style="color: #fff; background-color: #337ab7; border-color: #2e6da4"
	)
)
server <- function(input, output, session){

	observeEvent(eventExpr = input$update_document,{
		#file.remove("Notebook_Scraping.Rmd")
		root_xpath <- "/html/body/div/div/div/div/article" 
		page_url <- "function(nr) 'https://www.r-bloggers.com/'" 
		XPathes <- colnames(multicol_filt)[input$tbl_columns_selected + 1]
		update_document(
			XPathes = XPathes,
			root_xpath = root_xpath,
			page_url = page_url,
			selected_col = input$tbl_columns_selected %>% sort %>% safe_deparse
)
		stopApp(returnValue = invisible())
	})

	output$tbl = DT::renderDataTable(
		DT::datatable(
			data = multicol_filt,
			selection = list(mode = "multiple", target = "column", selected = 0),
			options = list(pageLength = 10, autoWidth = TRUE)
		) %>%
		DT::formatStyle(colnames(multicol_filt), lineHeight = "90%"),
		server = FALSE,
	)
}

runApp(
	appDir = shinyApp(ui, server), 
	launch.browser = shiny::paneViewer(minHeight = "maximize")
)
```
